# 1 关于shell

Shell本身是用于提供用户和OS内核的应用程序，用C语言编写。而本文说的shell指shell script，一种为shell编写的脚本程序。

常见脚本语言有：`JavaScript`（前端）、`JSP`、`PHP`（后端）、`Shell`

Linux的Shell种类众多，可以通过以下两条命令之一查看

```shell
chsh -l
cat /etc/shells
```

```shell
$usermod -s /sbin/nologin 用户名       # 可以让某个用户无法用shell来登录系统
```

本文关注于bash：（一般情况下对`#!/bin/sh`和`#!/bin/bash`等价）

```shell
/bin/bash

help   # 可以查看帮助
```

# 2 创建和运行
## 2.1 编写规范

**代码规范**

```shell
#!/bin/bash
```

告诉系统，指定当前这个脚本要用的shell解释器

**文件命名规范**

```
文件名.sh
```

## 2.2 编写流程

1. 创建.sh文件
2. 编写shell代码
3. 执行shell脚本【脚本必须得有执行权限】

```shell
chmod +x ./test.sh
./test.sh
```

脚本执行的另一个方式，直接运行解析器，shell脚本作为解释器的参数：

```shell
/bin/bash 脚本路径
/bin/sh 脚本路径   # bin/sh现在是/bin/bash的一个快捷方式
```

# 3 shell脚本编写

shell分为简单的写法（简单的命令的堆积）和复杂写法（程序的设计）

## 3.1 打印输出命令

```shell
echo 文本
```


注意：输出的内容如果包含字母和符号（不包含变量），需要用引号包括起来，如果是纯数字可包可不包

结尾的分号可加可不加，推荐不加

## 3.2 变量
### 3.2.1 定义变量

```shell
class_name="yunwei"
```

等号两边不能有空格，第二次赋值也是一样的，不加$

**反引号**

```shell
`
```

当在脚本中需要执行一些指令并且将执行的结果赋给变量的时候需要使用反引号

```shell
for file in `ls /etc`

for file in $(ls /etc)
```

### 3.2.2 使用变量

```shell
echo $class_name
```

前面加`$`
变量名外可以加`{}`来括起来

### 3.2.3 只读变量

```shell
readonly 变量名
```

### 3.2.4 接受用户输入

```shell
read -p 提示信息 变量名
```

### 3.2.5 删除变量

```shell
unset 变量名
```

# 4 字符串

字符串可以用单引号，也可以用双引号，也可以不用引号

**关于单双引号**

双引号能够识别变量，双引号能够实现转义
单引号不能识别变量，只会原样输出，单引号是不能转义的

## 4.1 拼接字符串

单双引号的字符串可以直接写在一起，进行拼接，如

```shell
name="roob"
str1="hello, "${name}"!"
echo str1
# hello, roob!
```

## 4.2 获取字符串长度

```shell
string="abcd"
echo ${#string}
```

## 4.3 提取子字符串

```shell
echo ${string:1:4}
```

提取从第2个字符开始的4个字符，第一个字符的索引值为0

## 4.4 查找子字符串

```shell
string="runnoob is a great site"
echo `expr index "$string" io`
# 输出4，查找字符i或o第一次出现的位置
```

# 5 shell数组

只能有1维数组，不限定数组的大小，下标从0开始

## 5.1 定义数组

圆括号括起来，空格隔开；或者array[0]=value这样一个个赋值

```shell
array=(v0 v1 v2 v3)

array2=(
v0
v1
v2
)

array3=v0
array3=v1
```

下标可以不连续，且范围没有限制

## 5.2 读取数组

```shell
${array[0]}
```


下标换成`@`表示获取全部元素

## 5.3 获取数组长度

```shell
length=${#array[@]}   # 或者将@换为*
lengthn=${#array[n]}  # 获取数组单个元素的长度
```

# 6 注释

## 6.1 单行注释

```shell
# 我是注释
```

## 6.2 多行注释

1. 可以将要注释的代码用花括号括起来定义成一个函数，不调用，就达到了和注释一样的效果

2. `:<<符号`

```shell
:<<EOF
注释内容...
EOF

# EOF还可以换成其他符号
:<<!
注释内容...
!
```

# 7 条件判断语句

```shell
if condition
then
    command1
    command2
elif condition2
then
    command3
else
    command4
fi
```

单行写法

```shell
if[ condition ];then command;fi
```

## for

```shell
for var in item1 item2 ... itemN
do
    command1
    command2
    ...
    commandN
done
```

```shell
for var in item1 item2 ... itemN; do command1; command2… done;
```

## while

```shell
while condition
do
    command
done

```

## case ... esac

```shell

case 值 in
模式1)
    command1
    command2
    ...
    commandN
    ;;
模式2）
    command1
    command2
    ...
    commandN
    ;;
esac
```



# 8 运算符

## 8.1 算术运算符
原生bash不支持简单的数学运算，但是可以通过其他命令来实现，如`awk`和`expr`

`expr`最常用，是一款表达式计算工具，例如：

```shell
#!/bin/bash
val=`expr 2 + 2`
```

**注意！！！**
**表达式与运算符中间必须要有空格，`2+2`不行，必须是 `2 + 2`**

`*`在表达式中需要转义才能是乘法

例如：

```shell
expr $a \* $b
```



| 运算符 | 说明                     |
| ------ | ------------------------ |
| `+`    | 加                       |
| `-`    | 减                       |
| `*`    | 乘，在表达式中得写成`\*` |
| `/`    | 除                       |
| `%`    | 取余                     |
| `=`    | 赋值                     |
| `==`   | 相等                     |
| `!=`   | 不等                     |
**条件表达式要放在方括号里，并且必须有空格，如`[ $a == $b ]`**

## 5.2 关系运算符
关系运算符只支持数字，不支持字符串，除非字符串的值是数字
| 运算符 | 说明                           |                     |
| ------ | ------------------------------ | ------------------- |
| `-eq`  | 检测两个数字是否相等           | equal，即==         |
| `-ne`  | 检测两个数是否不相等           | not equal，即！=    |
| `-gt`  | 检测左边的数是否大于右边的     | great than          |
| `-lt`  | 检测左边的数是否小于右边的     | less than           |
| `-ge`  | 检测左边的数是否大于等于右边的 | great than or equal |
| `-le`  | 检测左边的数是否小于等于右边的 | less than or equal  |
如果是返回true
## 5.3 逻辑运算符
| 运算符 | 说明 |
| ------ | ---- |
| !      | 非   |
| -o     | 或   |
| -a     | 与   |
取反的`!`后面可以不用空格

## 5.4 字符串运算符

| 运算符 | 说明                               | 举例        |
| ------ | ---------------------------------- | ----------- |
| =      | 检测两个字符串是否相等             | [ $a = $b ] |
| !=     | 检测两个字符串是否不等             |             |
| -z     | 检测字符串的长度是否为0            |             |
| -n     | 与-z相反，判断字符串长度是否不为0  |             |
| str    | 检测字符串是否为空，不为空返回true | [ $a ]      |
## 5.5 文件测试运算符
文件测试运算符用于检测Unix/Linux文件的的各种属性
| 操作符              | 说明                                                       |
| ------------------- | ---------------------------------------------------------- |
| -b file（文件路径） | 检测文件是否是块设备文件                                   |
| -c file             | 检测文件是否是字符设备文件（几乎不用）                     |
| -d file             | 检测文件是否是目录【常用】                                 |
| -f file             | 检测文件是否是普通文件（既不是目录也不是设备文件）【常用】 |
| -r file             | 检测文件是否可读【常用】                                   |
| -w file             | 检测文件是否可写【常用】                                   |
| -x file             | 检测文件是否可执行【常用】                                 |
| -s file             | 检测文件是否为空（文件大小是否大于0）【较常用】            |
| -e file             | 检测文件（包括目录）是否存在【常用】                       |

【-r-w-x只要有一个部分符合就认为是有权限的】

# 9 传参

命令行可以传递参数进来，用`$n`来获取参数，`$1`表示第一个参数，`“$0”`为`“./test.sh”`

另外有几个特殊字符

`$#` 传进来参数的个数
`$*` 以一个单字符串显示所有参数，参数用空格隔开
`$$` 当前进程ID
`$!` 后台运行的最后一个进程的ID
`$@` 所有传进来的参数，但是每个参数都会用引号隔开
`$-` 显示shell使用的当前选项
`$?` 显示命令的退出状态，0表示没有错误，其他任何值表示有错误



**`$*`与`$@`的区别**

区别只在双引号中体现出来。如果传递了三个参数1、2、3，则`"$*"`等价于`"1 2 3"`（一个参数），而`"$@"`等价于`"1"，"2"，"3"`（三个参数）

# 10 常用命令

**echo**

输出

**printf**

模仿C语言的输出

**test**

测试

