# 1 计算机网络概述

+ ISP：互联网服务提供商（Internet Service Provider）

## 1.1 OSI参考模型

+ 应用层——为计算机用户提供接口和服务
+ 表示层——数据处理：在传输之前是否进行加密 或 压缩 处理，二进制或ASCII码表示
+ 会话层——管理通信会话：需求端和网站之间的连接
+ 传输层——管理端到端的通信连接：可靠传输，流量控制，不可靠传输
+ 网络层——数据路由：负责选择最佳路径，规划IP地址(ipv4和ipv6变化只会影响网络层)
+ 数据链路层——相邻接点之间的数据通信：帧的开始和结束，还有透明传输，差错校验
+ 物理层——数据通信的光电物理特性：定义网络设备接口标准，电气标准(电压)，如何在物理链路上传输的更快

![1-网络分层模型](.\1-网络分层模型.png)

![2-数据封装过程](.\2-数据封装过程.png)

## 1.2 OSI参考模型对网络排错的意义

每一层都为上一层提供服务，一旦某一层崩了，上面所有层都崩了，所以排查问题从最底层(物理层)开始排查；

1. 物理层故障怎么办？
    查看链接状态，发送和接收的数据包数值；


2. 数据链路层故障怎么办？
    Mac地址冲突，2个一样的Mac地址同时访问；
    ADSL(非对称数字用户线路)欠费；
    两端的接口网速没有协商一致；
    计算机连接到其它VLAN(虚拟互联网)中。


3. 网络层故障怎么办？
    配置错误的IP地址，子网掩码，网关；数据有没有通过各个网关到达指定位置；


4. 应用层(上3层)故障怎么办？
    应用程序配置问题

### 1.2.1 OSI参考模型和网络安全解决办法：

1. 物理层安全隐患？
别人能私自接入你的网络，应该拔掉不用的网线或接口；


2. 数据链路层安全隐患？
ADSL账号密码，VLAN，交换机端口绑定Mac地址


3. 网络层安全隐患？
路由器上使用ACL(访问控制列表)控制数据包流量；防火墙设置；


4. 应用层安全隐患？
应用程序有没有漏洞；

## 1.3 计算机网络的性能指标

### 1.3.1 速率

连接在计算机网络上的主机在数字信道上传送数据位数的速率，也称data rate或bit rate(比特率)，单位是b/s, kb/s, Mb/s, Gb/s。和下载文件时显示的网速的关系是除以8。

### 1.3.2.带宽

数据通信领域中，数字信道所能传送的最高数据率，单位是b/s, kb/s, Mb/s, Gb/s。常见的是Mpbs。

### 1.3.3.吞吐量

在单位时间内通过某个网络的数据量，单位是b/s, Mb/s。

### 1.3.4.时延

包括**发送时延，传播时延，处理时延，排队时延**。

发送时延等于数据块长度(bit)除以信道带宽(bit/s). 更快的发送速度意味着波长越短，链路上的数据量更大；

更快的传播速度意味着在网线中更快的传播速度。

### 1.3.5.时延带宽积

时延×带宽
有多少数据正在线路上。

### 1.3.6.往返时间(RTT, Round-Trip Time)

从发送方发送数据开始，到发送方收到接收方确认数据的时间。

可以通过ping命令测量。

### 1.3.7.利用率

包括信道利用率：有数据通过的时间/总时间

网络利用率：信道利用率的加权平均

网络当前时延D = 网络空闲时时延D0 / (1 - 信道利用率U)

# 2 物理层

### 2.1 物理层定义的标准

+ 物理层解决如何在连接各种计算机的传输媒体上传输数据比特流，而不是指具体的传输媒体。

+ 物理层的主要任务：确定传输媒体的接口的一些特性，包括，
  + 机械特性：接口形状，大小，引线数量
  + 电气特性：例如规定电压范围(-5V-5V)
  + 功能特性：例如规定-5V上0，+5V是1
  + 过程特性：也称规程特性，规定建立连接时各个相关部件的工作步骤

### 2.2 数据通信基础知识

![3-数据通信模型](.\3-数据通信模型.png)

#### 2.2.1 通信的目的是传送消息

+ 数据(data)——运送消息的实体。

+ 信号(signal)——数据的电气或电磁的表现。

  + 模拟信号——代表信息的参数的取值是连续的。

  +  数字信号——代表信息的参数的取值是离散的。
+ 码元(code)——在使用时间域的波形表示数字信号时，代表不同离散数值的基本波形。
  在数字通信中常常用时间间隔相同的符号表示一个二进制数字，这样的时间间隔内的信号称为二进制码元。这个间隔称为码元长度，1 code可以携带n bit信息量(此时电压会有多个取值，例如1，2，…,7V，而不是只有2个取值)。

#### 2.2.2 信道的概念

信道一般表示向一个方向传输信息的媒体。所以通信线路往往包含一条发送信息的信道和一条接收信息的信道。

+ 单向通信(单工通信)——只能有一个方向的通信，没有反向交互。

+ 双向交替通信(半双工通信)——通信的双方都可以发送信息，但是不能双方同时发送或接收。

+ 双向同时通信(全双工通信)——通信的双发可以同时发送和接收。

#### 2.2.3 什么是基带(baseband)和带通(base pass)信号？

+ 基带信号(基本频率信号)——来自信源的信号，例如计算机输出的代表各种文字或图像文件的数据信号都属于基带信号。基带信号就是发出的直接表达了要传输的信息的信号，比如说我们说话的声波。
+ 带通信号——把基带信号经过载波调制后，把信号的频率范围迁移到较高的频段以便在信道中传输(即仅在一段频率范围内能够通过信道)。
+ 因此在传输距离较近时，采用基带传输方式(衰减不大，信号内容不会变化)。传输距离较远时，采用带通传输方式，例如从计算机到监视器，打印机等外设的信号。

![4-基带信号与带通信号](.\4-基带信号与带通信号.png)

#### 2.2.4 几种基本的调制方法

从基带信号到带通信号，涉及到 调频(AM)，调频(FM)，调相(PM)。
![5-信号调制方法](.\5-信号调制方法.png)

#### 2.2.5 常用编码方式

+ 单极性不归零编码：只使用一个电压值，高电平表示1，低电平表示0.
+ 双极性不归零编码：用幅值相等的正负电平表示二进制数1和0.
+ 单极性归零编码：发送码1时高电平在整个码元期间只持续一段时间，其余时间返回零电平。
+ 双极性归零编码：正负零三个电平，信号本事携带同步信息。

![6-信号编码](.\6-信号编码.png)



+ 曼彻斯特编码：单极性编码的缺点是没有办法区分此时是没有信号，还是有信号，但是信号是0.
  这种编码方式是bit中间有信号，低-高跳转表示0，高-低跳转表示1，一个时钟周期只可以表示一个bit，并且必须通过两次采样才能得到一个bit。它能携带时钟信号，而且能区分此时是没有信号还是信号为0.

![7-曼彻斯特编码](.\7-曼彻斯特编码.png)

+ 差分曼彻斯特编码：抗干扰能力比曼彻斯特编码更强。bit与bit之间有信号跳变，表示下一个bit为0，bit与bit之间没有信号跳变，表示下一个bit为1。

![8-差分曼彻斯特编码](.\8-差分曼彻斯特编码.png)

#### 2.2.6 信道极限容量

信道极限容量取决于失真的大小，当失真过大时，接收信号无法还原发送信号。
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010212540244.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

#### 2.2.7 奈氏(Nyquist)准则

在理想条件下(无噪声/干扰/失真)，为了避免码间串扰，码元的传输速率是有上限的。如果信道的频带越宽(信号高频分量越多)，则用更高的速率传输码元也不会出现码间串扰。

#### 2.2.8 信噪比和香农(Shannon)公式

信道的极限信息传输速率C(带宽受限且有Gauss白噪声干扰时的信道极限且无差错时的信息传输速率)可表示为，
C = W log2(1 + S / N) b/s
->W是信道的带宽(Hz)；
->S是信道内所传信号的平均功率；
->N是信道内的Gauss噪声的功率。
可以发现，减少速度和增大功率能提高准确度。
信道的带宽或信道中的信噪比(S/N)越大，则信息的极限传输速率C就越高；
只要信息传输速率小于信道的极限传输速率C，就一定能实现某种无差错传输；
若带宽W或信噪比(S/N)没有上限，则极限传输速率C也没有上限(虽然不可能)；
实际上，信道能达到的最高传输速率要比C低不少；

#### 2.2.9 奈氏(Nyquist)准则和香农公式的应用范围

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102125508584.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

### 2.3 物理层下面的传输介质

#### 2.3.1 导向传输媒体

导向传输媒体中，电磁波沿着固体媒体传播。
双绞线：
->屏蔽/非屏蔽双绞线(STP/UTP)
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010212553584.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
同轴电缆：
->50欧姆同轴电缆(基带同轴电缆)——用于数字传输，多用于基带传输；
->75欧姆同轴电缆(宽带同轴电缆)——用于模拟传输，多用于带通传输；
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102125556959.png)
光缆：
网线：
->直通线——双绞线夹线顺序两端一致(1白橙2橙3白绿4蓝5白蓝6绿7白棕8棕，口诀“橙白橙/绿白蓝/蓝白绿/棕白棕”)，这是100M的标准(568B)，也称正线/标准线/直通线。当用于10M和100M时，下图只用了1，3，2，6线。对于1000M的网络，8根线都会用上。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102125618389.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
直通线应用最广，这种类型的以太网电缆用来实现以下连接：主机到交换机/集线器，路由器到交换机/集线器。
->交叉线——一般不同设备连接用直通线，同类设备用交叉线。也用于集线器到交换机，路由器到主机连接。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102125705746.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
注意，现在网卡能够自动协商，所以交叉线和直通线已经无所谓了，连错了也没关系。
光纤：
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010212572797.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
单模光纤——只能传输一种电磁波；直径小；用于有线电视网络，传播特性好，带宽可达10GHz，可以在一根光纤中传输60套PAL-D电视节目。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102125745955.png)
多模光纤——能传输多种电磁波；直径大；
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102125755384.png)

#### 2.3.2 非导向传输媒体

非导向传输媒体指自由空间，其中的电磁波传输称为无线传输。
无线传输的频段很广。
短波通信主要是靠电离层的反射，但短波信道的通信质量较差；
微波在空间主要是直线传播(延迟大)——地面微波接力通信；微信通信。
电信领域使用的电磁波的频谱如下，
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102125822870.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

#### 2.3.3 物理层设备

集线器：
工作特点是在网络中只起到信号放大和重发作用，目的是扩大网络的传输范围，而不具备信号的定向传送能力。最大传输距离是100m；集线器是一个大的冲突域(意思是某个时间点只能是2台设备进行通信)。
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010212590985.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
现在很少用集线器了，它不安全，一般用交换机。

### 2.4 信道复用技术

复用(multiplexing)是通信技术中的基本概念。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102125945333.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

#### 2.4.1 频分复用(FDN: frequency division multiplexing)

用户在分配到一定的频带后，在通信过程中始终站用这个频带。频分复用的所有用户在同样的时间占用不同的带宽资源(带宽指频率带宽不是数据的发送速率)。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102130014245.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

#### 2.4.2 时分复用(TDN: time division multiplexing)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102130042980.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
实现机制：
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102130118549.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
时分复用可能会造成线路资源的浪费，由于计算机数据的突发性质，用户对分配到的子信道的利用率一般不高。
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010213013860.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

#### 2.4.3 统计时分复用(STDM: statistic TDM)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102130206938.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
需要在放置前添加标记。

#### 2.4.4 波分复用(WDM: wavelength division multiplexing)

就是光的频分复用。
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010213023966.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

#### 2.4.5 码分复用

常用的名词是码分多址CDMA(Code Division Multiple Access)
各用户使用经过特殊挑选的不同码型，因此彼此不会造成干扰。
这种系统发送的信号有很强的抗干扰能力，其频谱类似于白噪声，不易被敌人发现。
每一个比特时间划分为m个短的间隔，称为码片(chip)。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106112052415.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
任何一个码片向量和该码片向量自己的规格化内积都是1.
任何一个码片向量和该码片反码向量的规格化内积都是-1.
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106112106614.png)
缺点：表示一个bit需要更多的数据。

### 2.5 数字传输系统

主要讲的是广域网的数据传输。
脉码调制(PCM)技术。欧洲是E1标准(30路)，北美是T1(24路，时分复用)。

### 2.6 带宽接入技术

#### 2.6.1 非对称数字用户链路ADSL

使用电话线。用数字技术对现有的模拟电话用户线进行改造(xDSL)，把0-4kHz留给传统电话使用，把原来没有利用的高频谱段留给用户上网使用。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102130314457.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
基于ADSL的接入网组成如下图，
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102130325183.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
数字用户线接入复用器DSLAM(DSL Access Multiplexer)
接入端单元(Access Termination Unit)
ATU-C(C表示端局Central Office)
ATU-R(R代表远端Remote)
电话分离器PS(POTS Splitter)

#### 2.6.2 DMT技术

采用频分复用，把40kHz以上一直到1.1MHz的高频谱划分为徐队子信道，其中25个子信道用于上行信道，249个子信道用于下行信道(因为下载的情景多于上传)。每个子信道占据4kHz的带宽，并使用不同的载波进行数字调制。这种做法相当于在一对用户线上使用许多小的调制解调器并行地传输数据。

#### 2.6.3 光纤同轴混合网HFC(Hybrid Fiber Coax)

HFC网是在目前覆盖范围很广的有线电视网CATV基础上开发的一种居民宽带接入网。除了可以传送CATV外，还可以提供电话/数据/和其它宽带交互型业务。现有CATV网是树形拓扑结构的同轴电缆网络，它采用 模拟技术的频分复用 对电视节目进行单向传输。HFC需要对CATV网进行改造。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102130415388.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
每个用户要安装一个用户接口盒。
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010213044034.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

#### 2.6.4 FTT技术(光纤到XX技术)

->光纤到家技术(Fiber to the home):光纤一直铺设到用户家庭(155MB/s)。
->光纤到大楼技术(Fiber to the building):光纤进入大楼后就转为电信号，然后用电缆或双绞线分配到各用户。
->光纤到路边技术(Fiber to the curb):从路边到各用户可以使用星形结构的双绞线作为传输媒体(155MB/s)。

参考文献
https://www.bilibili.com/video/av9876107?p=7

# 3 数据链路层

# 3.1 数据链路层的基本概念

## 3.1.1 数据链路层的简单模型

数据链路层不关心物理层解决的问题，只关心帧头帧尾和校验。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102231430200.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

# 3.1.1 数据链路层的信道类型

->点到点信道：这种信道使用一对一的点对点通信方式。
->广播信道：广播信道上的主机很多，需要专用的共享信道协议来协调主机的数据发送。

# 3.1.2 链路与数字链路

->链路(link)——是一条点到点的物理线路段，中间没有任何其他的交换节点。一条链路只是一条通路的一个组成部分。
->数据链路(data link)——除了物理线路外，还必须有通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。最常用的方法是使用适配器(网卡)来实现这些协议的硬件和软件。一般的适配器都包括了数据链路层和物理层这两层的功能。

## 3.1.3 帧

在网络层，给数据包增加了接收端和发送端的IP地址。在数据链路层里，增加了帧头帧尾，MAC地址和校验值。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102231525963.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

# 3.2 数据链路层解决的基本问题

## 3.2.1 封装成帧(framing)

就是在一段数据的前后分别添加帧头和帧尾，构成一个帧，确定帧的界限。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102231600571.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
但是，可能会出现以下问题，
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102231622678.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 3.2.2 透明传输

用字节填充法解决透明传输问题。发送端的数据链路层在数据中出现控制字符“SOH”或“EOT”的前面插入一个转义字符“ESC”(十六进制数1B)。
字节填充(byte stuffing)或字符填充(character stuffing)——接收端的数据链路层在数据送往网络层之前杀出插入的转义字符。
如果转义字符也出现在数据之中，那么应该在转义字符前插入一个转义字符。当接收端收到连续的两个转义字符时，就删除前面的那一个。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102231659526.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 3.2.3 差错校验

传输过程中可能会产生bit差错：0变成1，1变成0.
在一段时间内，传输错误的比特率占所传输比特总数的比率称为误码率BER(bit error rate)。
误码率和信噪比的关系很大。
为了保证数据传输的可靠性，在计算机网络传输数据时，必须采用各种差错检验措施。
->循环冗余检验CRC:
除数必须比后面添加的0的位数多一位，可以是任意的二进制数。每一步运算其实是不进位的加法。下图的001就是FCS帧检验序列。接收端计算101001001(也就是原数据加上FCS)除以1101，如果商为0，意味着传输过程没有差错，就接受，否则丢弃。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102231718200.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
在数据后面添加的冗余码称为帧检验序列FCS(frame check seqeunce)。CRC不是获得FCS的唯一方法。
特点：
不能确定出错的bit的是哪一位；
可能会出错，但只要经过严格的挑选，并且除数位数足够大，就可以极大减少出错概率；
CRC只能做到无差错接受(意思是传输过程没有差错，有差错的一律丢弃)；
要做到可靠传输，必须加上确认和重传机制。

# 3.3 两种情况下的数据链路层

## 3.3.1 使用点对点信道的数据链路层(广域网)

(1)PPP协议(point to point protocol)，是数据链路层协议，例如用户使用拨号上网。
(2)PPP协议应该满足：
简单；封装成帧；透明性；多种网络层协议；多种类型链路；差错检验；检测连接状态；最大传送单元；网络层地址协商；数据压缩协商；
(3)PPP协议不需要满足：
纠错；流量控制；序号；多点链接；半双工或单工连接。
(4)PPP协议的组层部分：
数据链路层协议可以用于异步串行或同步串行介质；
使用LCP(链路控制协议)建立并维护数据链路连接，可以实现身份验证和欠费管理；
网络控制协议(NCP)允许在点到点连接上使用多种网络层协议，如下图；
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010223174734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(5)PPP协议帧格式
标志字段F = 0x7E
地址字段A = 0xFF，它并不起作用
控制字段C = 0x03
PPP协议是面向字节的，所以所有的PPP帧的长度都是整数字节。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102231805348.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(6)字节填充(类似于透明传输)
此时，信息部分是以字节为单位的。
将信息字段中出现的每个0x7E字节转变成为2字节序列(0x7D,0x5E);
将信息字段中出现的每个0x7D字节转变成为2字节序列(0x7D,0x5D);
将信息字段中出现的每个ASCII码控制字符(小于0x20字符)，在前面加入一个0x7D；
(7)0比特填充(类似于透明传输)
此时，信息部分是二进制流。PPP协议在SONET/SDH链路时，是使用同步传输。
在发送端，只要发现有5个连续的1，则填充一个0，接收端删掉对应的0。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102231832418.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(8)PPP协议不使用序号和确认机制的原因
在数据链路层出现错误的概率不大时，使用较简单的PPP协议较为合理；
在Internet环境下，PPP的信息字段放入的数据是IP数据报。数据链路层的可靠传输并不能保证网络层的传输也是可靠的；
帧检验序列FCS字段可以保证无差错接受。
(9)PPP协议的工作状态
当用户拨号接入ISP(网络运营商)时，路由器的调制解调器对拨号进行确认，建立物理连接；
PC机箱路由器发送一些列的LCP(链路控制协议)分组(封装成多个PPP帧)；
这些分组及其响应选择一些PPP参数，和进行网络层配置，NCP(网络控制协议)给新接入的PC机分配一个临时的IP地址，使PC机成为Internet上的一个主机；
通信完毕后，NCP释放网络层连接，收回原来分配出去的IP地址；
接着，LCP释放数据链路层连接；
最后释放的事物理层连接。

## 3.3.2 使用广播信道的数据链路层(局域网)

一般是总线型。
(1)局域网的拓扑
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010223185676.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(2)共享通信媒体
静态划分信道(麻烦)：
频分复用；时分复用；波分复用；码分复用；
动态媒体接入控制(多点接入)：
随机接入(主要是以太网)；受控接入，如多点线路探询(polling)，轮询(不采用了)。

(3)认识以太网
最初的以太网是将许多计算机都连接到一根总线上，当初认为这样连接即简单又可靠，因为总线上没有有源器件。
总线上每一个主机都能检测到B发送的数据。但是只有D的地址和数据帧首部写入的地址一致，所以只有D接收。其余计算机都能检测到这不是发送给他们的数据帧，所以就丢弃这个数据帧。
这是一种具有广播特性的总线上实现了一对一通信。这种方式不安全。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102231909360.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

(4)带冲突检测的载波监听/碰撞检测
CSMA/CD：
Carrier Sense Multiple Access with Collision Detection
多点接入：
许多计算机以多点接入的方式连接在一根总线上。
载波监听：
每一个站在发送数据之前都先要用电子技术检测一下总线时候有其它计算机在发送数据信号，如果有则不发送数据，以免发生碰撞；

(5)碰撞检测
碰撞检测就是计算机边发送数据边检测信道上信号电压的大小。
当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大；
当一个站检测到信号电压摆动值超过一定的门限值时，就认为总线上至少有两个站在同时发送数据，表明产生了碰撞；
碰撞就是冲突，碰撞检测也称冲突检测。
检测到碰撞后：
在发生碰撞时，总线上传输的信号产生了严重的失真，无法从中恢复出有用的信息；
每一个正在发送数据的站，一旦发现总线上出现了碰撞，就立即停止发送，避免浪费网络资源，等待一个随机的时间后再次发送。

(6)传播时延对载波监听的影响
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102231927199.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
在2t时间内，可能存在碰撞。

(7)CSMA/CD的重要特性
使用CSMA/CD协议的以太网不能进行全双工通信而只能进行双向交替通信(半双工)；
每个站在发送数据之后的一小段时间内，存在着遭遇碰撞的可能；
这种发送的不确定性使整个以太网的平均通信量远小于以太网的最高数据率。

(8)争用期
最先发送数据帧的站，在发送数据帧后至多经过时间2t(2倍的端到端往返时延)就可知道发送的数据帧是否发生了碰撞。
经过争用期这段时间还没有检测到碰撞，就可以肯定不会发生碰撞；
以太网的争用期：
->以太网的端到端往返时延2t称为争用期，或碰撞窗口，通常取51.2微秒为争用期的长度；如果网线过长，会导致争用期时间的延长，这也是为什么网线一般不超过100m；
->对于10Mb/s的以太网，在争用期可以发送512bit，也就是64 byte；
->以太网在发送数据的时候，若前64字节没有冲突，后续也不会发生冲突；
最短有效帧长：
->如果发生冲突，一定是前64字节；
->由于一旦发生冲突就立刻停止，所以已发送的数据一定小雨64字节；
->以太网规定了最短有效帧长为64字节，凡事小雨64字节的帧一定是因为冲突而异常终止的无效帧。

(9)二进制指数类型退避算法
发送碰撞的站在停止发送数据后，要推迟一个随机事件才能发送数据。
确定基本退避时间，一般是争用期2t；
定义参数k = min(重传次数，10)；
从整数集合{0,1,…,2^k-1}中随机取出一个数，记为r，重传所需的时延就是r倍的基本退避时间；
当重传达16次时仍不能成功时就丢弃该帧，并向高层报告。

# 3.4 以太网

## 3.4.1 以太网的两个标准

DIX Ethernet V2一般是指这个。
IEEE 802.3 两个标准差别很小。
以太网 是满足DIX Ethernet V2标准的局域网。

## 3.4.2 以太网与数据链路层的2个子层

为了使数据链路层更好的适应多种局域网标准，802委员会把局域网拆分为：
->逻辑链路控制LLC(Logical Link Control)子层；
->媒体接入控制MAC(Medium Access Control)子层。
与接入到传输媒体有关的内容都放在MAC子层上，而LLC子层与传输媒体无关，不管什么协议的局域网对LLC子层都是透明的；
由于局域网标准一般是DIX Ethernet V2而不是IEEE 802.3，所以802.2标准的LLC子层作用已经不大了，很多厂商适配器没有LLC协议；

## 3.4.3 以太网提供的服务

以太网提供服务是不可靠的交付，即最大努力的交付；
当接收站收到的有差错的数据帧时就丢弃此帧，其它什么也不做，差错的纠正由高层来处理；
如果高层发现丢失了一些数据而进行重传，但以太网并不知道这是一个重传的帧，而是当作一个新帧发送。

## 3.4.4 以太网的星型拓扑结构

物理上是星型，逻辑上是总线型。
为了降低成本，最初由粗的同轴电缆变成细的同轴电缆最后变成无屏蔽双绞线。每个站需要用两对双绞线，分别用于发送和接收；
在星形的中心增加了一种可靠性高的设备，为集线器(hub)。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102232000978.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 3.4.5 集线器的特点

集线器使用电子器件来模拟实际电缆线的工作，因此整个系统仍然是像一个传统的以太网那样运行。由于集线器使用了大规模集成电路芯片，所以可靠性更高；
使用集线器逻辑上仍然是一个总线网，各工作站使用的还是CSMA/CD协议，共享逻辑网络上的总线；
集线器像一个多接口的转发器，工作在物理层。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102232025486.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 3.4.6 10Base-T 基于集线器的以太网标准

它的通信距离稍短，每个站到集线器的距离不超过100m。
这种10MB/s的无屏蔽双绞线星形网的出现，能降低成本和提高可靠性。
10Base-T的出现有很大的意义，类似标准有100Base-FX，10Base-T，100Base-T4.

## 3.4.7 信道利用率

争用期长度为2t；帧长为L bit，数据发送旅为C b/s，帧的发送时间为L/C = T0 秒。
一个帧从开始发送，经可能发生的碰撞后，将再次重传多次，直到发送成功且信道转为空闲(即再经过t使得信道上没有信号在传播)时为止，是发送一帧所需的平均时间。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102232044653.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
定义a = t / T0，是单程端到端时延t与帧发送时间T0的比值。a越小，说明碰撞检测越快，信道利用率高。
当数据率(网速)一定时，以太网的连线长度受到限制，否则t会太长；
以太网的帧长不能太短，否则T0太小，使a太大。

## 3.4.8 信道利用率的最大值

假设理想状态下，以太网个展发送的数据都不会碰撞，一旦总线空闲就能有站立即发送数据，所以没有争用期；
发送一帧需要占用总线T0+t，而帧本身需要发送时间为T0，于是理想情况下极限信道利用率Smax = T0 / (T0 + t) = 1 / (1 + a).

# 3.5 MAC层

## 3.5.1 MAC层的硬件地址(MAC地址)

硬件地址 = 物理地址 = MAC地址
MAC地址前3个字节(24位)是厂家分配的地址字段，后3个字节(24位)是厂家自定义，称为扩展标识符；
一个地址块可以产生2^24个地址，这种48位地址称为MAC-48，通用名为EUI-48，这就是MAC地址；
MAC地址实际上是每一个站的名字或标识符。

## 3.5.2 适配器检查MAC地址

适配器从网络上每收到一个MAC帧就要用硬件检查MAC帧中的MAC地址：
->如果是发往本站的帧就收下，然后进行其它处理；
->否则丢弃。
发往本站的帧包括：
->单播帧(unicast)(一对一)
->广播帧(broadcast)(一对全体)
->多播帧(multicast)(一对多)

## 3.5.3 MAC帧的格式

6 + 6 + 2 + 46 + 4 =64 byte，这就是为什么IP数据报的最短长度为46字节。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102232142275.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
前8个字节的作用是实现比特同步，第一个字段共7个字节，称为前同步码，作用是实现快速MAC帧的比特同步；第二个字段是帧开始定界符，表示后面的信息是MAC帧。
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010223215677.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 3.5.4 无效的MAC帧

帧的长度不是整数个字节；
用收到的帧检验序列FCS查出有错误；
数据字段的长度不在46-1518字节内；
对于检查出来的无效MAC帧简单的丢弃。

## 3.5.5 帧间最小间隔

为9.6微秒。相当于96bit的发送时间。
一个站在检测到总线空闲时，还需要等待9.6微秒后才能再次发送数据，这样做是为了使刚刚收到的数据帧的站接收缓存来得及清理，做好接收下一帧的准备。

# 3.6 数据帧的抓包分析

# 3.7 扩展以太网

## 3.7.1 在物理层考虑扩展

(1)距离的扩展
主机使用光纤和一对光纤调制解调器连接到集线器。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102232208881.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(2)数量的扩展
集线器集联：使网络中计算机增加，变成一个大的冲突域，会造成效率降低。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102232226498.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 3.7.2 在数据链路层考虑扩展

(1)使用网桥
网桥工作在数据链路层，他根据MAC帧的目的地址对收到的帧进行转发。网桥具有过滤帧的功能。当网桥收到一个帧时，并不是向所有的接口转发此帧，而是现检查此帧的目的MAC地址，然后再确定将该帧转发到对应的接口。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102232240544.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(2)交换机
随着网桥的接口的增加， 后来网桥和集线器合并了，计算机可以直接和交换机连接，这就是交换机。
交换机就是网桥和集线器的合并升级版，能全双工，安全通信。
端口带宽独享；
安全；
基于MAC地址转发；
通过学习构建MAC地址表。
(3)透明网桥(transparent )
透明指局域网上的站点不知道所发送的帧将经过几个网桥，因为网桥对于各站点是看不见的。
透明网桥是一种即插即用的设备，标准是IEEE 802.1D。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102232254100.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
透明网桥使用了生成树算法。避免产生转发的帧在网络中不停的转圈。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102232312928.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010509202810.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

# 3.8 快速以太网(fast ethernet)

## 3.8.1 100Base-T以太网

速率在100Mb/s以上的以太网称为高速以太网。
在双绞线上传送100Mb/s基带信号的星型拓扑以太网，仍使用IEEE 802.3的CSMA/CD协议。100Base-T以太网被称为快速以太网(fast ethernet)。
100Base-T以太网的物理层：
->100Base-TX:使用2对UTP 5类线或屏蔽双绞线STP。
->100Base-FX:使用2对光纤。
->100Base-T4:使用4对UTP 3类线或5类线。

## 3.8.2 100Base-T以太网的特点

可以实现全双工通信(注意，如果交换机上某一路连接着集线器(半双工)，则这一路不能实现全双工)而无冲突，此时不使用CSMA/CD协议。
MAC帧格式不变，仍是802.3 标准。
最短帧长度不变，但是一个网段的最大电缆长度减少到100m。
帧间间隔从9.6微秒缩小到0.96微秒。

## 3.8.3 吉比特Gbit以太网

允许在1 Gb/s下全双工或半双工工作方式。
使用802.3标准的帧格式。
在半双工下使用CSMA/CD协议。
与10Base-T和100Base-T技术向后兼容。
当吉比特以太网在全双工方式时，不用载波延伸和分组冲突。
1000Base-X以太网的物理层(基于光纤通道)：
->1000Base-SX：SX表示短波长，传输距离上275m或550m。
->1000Base-LX：LX表示长波长，传输距离上550m或5000m。
->1000Base-CX：
1000Base-T以太网的物理层(基于双绞线)：
->使用 4对 5类线UTP。
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010223234353.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 3.8.4 10Gbit/s以太网

MAC帧格式不变，仍是802.3 标准。
使用光纤而不是铜线。
只能工作在全双工方式，没有争用问题。
它的出现使工作范围从局域网扩大到城域网和广域网，实现了端到端的以太网传输，优点是：技术成熟；互操作性好；广域网中使用以太网便宜；统一的帧格式。

## 3.8.5 以太网从10Mb/s到10Gb/s的演变说明了

可拓展性；
灵活性(多种传输媒体，全/半双工，共享/交换)；
易于安装；
稳健性好。

## 3.8.6 Cisco建网的3层模型

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200102232405178.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

参考文献
https://www.bilibili.com/video/av9876107?p=7

# 4 网络层

# 4.1 网络层提供的服务

## 4.1.1 网络层的作用

负责在不同的网络之间(基于数据包的IP地址)尽力转发数据包，不负责丢包重传和接收顺序。
有点像送快递，一个人往另一个地方寄快递，每个快递走不同的路线，可能后发的先到了，也可能丢件了。但是网络层不管这些，只管寄快递。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200103224039867.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
数据包在Internet中的传输，Internet既有局域网，又有广域网，既有光纤，又有铜线，无线，还有不同的协议，这是Internet复杂所在。
路由器是三层设备：能看到网络层的IP地址来选择路径。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200103224044522.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 4.1.2 互联网络与虚拟互联网络

(1)互联网互联的设备
中间设备又称为中间系统或中继(relay)系统。

> ->物理层中继系统：转发器(repeater)，有点像集线器。
> ->数据链路层中继系统：网桥或桥接器(bridge)。
> ->网络层中继系统：路由器(router)。
> ->传输层/应用层中继系统：网关(gateway)器。
> 网关就是路由器接口的地址。一般是本网段第一个地址。

(2)网络需要解决的问题
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105161422907.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(3)虚拟网络把复杂的Internet看成一个网络，化简问题。虚拟互联网络就是逻辑互联网络，他的意思就是互联起来的各种物理网络的异构性本来就是客观存在的， 但是我们利用IP协议就可以使这些性能各异的网络从用户看起来好像是一个统一的网络，而不用考虑具体的网络异构细节。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200103224137911.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

# 4.2 网络设备和OSI参考模型的关系

## 4.2.1举例，PC4向PC3传输数据

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200103224145981.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
PC：计算机；Hub：集线器；Switch：交换机；Router：路由

**发送端(封装)：**

> (1)应用层准备要传输的数据；
> (2)传输层把文件进行分段并编号；(数据段)
> (3)网络层把传输层的每一个数据包增加原IP地址和目标IP地址；(数据包)
> (4)数据链路层把每个数据加上MAC地址；两种情况：(数据帧)
> 使用自己的子网掩码，判断自己和目标地址分别在哪个网段，若在同一个网段(不过路由器)，通过ARP协议广播的方式得到目标IP地址的MAC地址，然后就能封装出一个数据帧；如果子网掩码不是一个网段(用与运算)，通过ARP协议广播的方式得到路由器(网关)的MAC地址，然后把数据通过交换机发送到路由器M2，因为M2和M3是点对点通信，没有别的主机，所以它们之间的MAC地址就是FF。
> (5)物理层把数据帧变成数字信号(bit流)

**接收端(解封)：**

> (1)交换机Hub0接收bit流，能对数据进行存储转发。它根据数据帧的MAC地址，确定数据是从哪来的，要去哪。
> (2)路由器M2获取交换机的数据包，识别其中的IP地址，根据路由表选择出口，它无法识别数据段内容。
> (3)路由器M2到M3是点对点通信，遵守PPP协议。
> (4)PC3收到bit流后，数据链路层发现MAC地址是自己的，去掉MAC地址给它的网络层，网络层去掉IP地址给传输层，传输层把数据给应用层，应用层把各个数据拼接起来。

## 4.2.2 路由器/交换机/集线器会不会中病毒

不会，路由器不能识别数据内容。它只负责信息的传递。但是病毒会影响网络设备。因为病毒会占用网络流量。

# 4.3 ARP协议

## 4.3.1 TCP/IP协议层次关系

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200103224222401.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
IP协议：把数据包从一个网段转到另一个网段，就是用来选择路径用的。
ARP为IP服务，IP为ICMP/IGMP服务。

## 4.3.2 ARP协议的作用

将IP地址通过广播(本网段，不通过路由器)，目标MAC地址是FF-FF-FF-FF-FF-FF，解析目标IP地址的MAC地址。
ARP是解决同一个局域网上的主机或路由器的IP地址和MAC地址的映射关系。如果所找的主机和原主机不在同一个局域网上，那么就要通过ARP找一个位于本局域网上的某个路由器的MAC地址，然后把分组发送给这个路由器，让这个路由器把分组转发给下一个网络。剩下的工作就由下一个网络来做。
从IP地址到MAC地址的解析是自动进行的，主机的用户对这种地址解析过程是不知情的。
只要主机或路由器要和本网络上的另一个已知IP地址的主机或路由器进行通信，ARP协议就会自动地将该IP地址解析为链路层所需要的MAC地址。

## 4.3.3 使用ARP的四种典型情况

(1)发送方是主机，要把IP数据报发送到本网络的另一个主机，此时用ARP找到目标主机的MAC地址；
(2)发送方是主机，要把IP数据报发送到另一个网络的另一个主机，此时用ARP找到本网络上一个路由器的MAC地址，剩下的工作由路由器进行；
(3)发送方是路由器，要把IP数据报发送到本网络的另一个主机，此时用ARP找到目标主机的MAC地址；
(4)发送方是路由器，要把IP数据报发送到另一个网络的另一个主机，此时用ARP找到本网络上一个路由器的MAC地址，剩下的工作由路由器进行；

## 4.3.4 逆地址解析协议RARP

只知道自己MAC地址就能获得其IP地址。

## 4.3.5 ARP欺骗/网络执法官/ARP防火墙-实验课

如果同一网段中有电脑中毒，可能会把中毒电脑的MAC地址传回去。

# 4.4 网际控制报文协议ICMP

## 4.4.1 ICMP

ICMP：在IP之上，用来测试网络层有没有故障。使用最多的命令是ping。
为了提高IP数据报交付成功的机会，在网络层使用了ICMP(Internet Control Message Protocol)。
ICMP允许主机或路由器报告差错情况和提供有关异常情况的报告；
ICMP不是高层协议，而是IP层协议；
ICMP报文件为IP层数据报的数据加上数据报的首部，组成IP数据报发送出去。

## 4.4.2 ping(Packet Internet Grope)命令诊断网络故障

PING是网络层命令。
TTL是数据报的生存时间每过一个路由器就会减1，作用是防止数据报在网络中循环。TTL默认初始值如下：
Linux 64
Windows 128
Unix 256
可以根据TTL值粗略判定对方是什么系统。

(1)PING,因特网包套所起，用于测试网络连接量的程序。ping发送一饿ICMP回声请求消息给目的地并报告是否收到所希望的ICMP回声应答。
(2)ping指端对端联通，通常用作可用性检测，但是某些病毒会强行大量远程执行ping命令抢占你的网络资源，导致系统网速变慢。严禁ping入侵作为大多数防火墙的一个基本功能提供给用户进行选择。
(3)如果打开IE浏览器访问网站失败，可以通过ping命令测试到Internet的网络连通，可以为你排除网络故障提供线索。

## 4.4.3 ping和pathping命令

QQ能登上，网页打不开是为什么？ 网络层没有问题，域名解析有问题。
pathping 能跟踪数据包路径，发现出问题的位置。
Windows上跟踪数据包路径的命令：tracerert 10.7.1.53
路由器上跟踪数据包路径的命令：traceroute 12.0.0.3

# 4.5 IGMP协议和多播组播

点到点通信：
广播：目标MAC地址全是F，目标IP地址全是255，也就是全是1.全网广播不能跨越路由器。
组播=多播：分组广播。

## 4.5.1 访问多播视频节目

使用多播一般用于直播，网络会议，能够节省带宽。
IGMP协议的作用就是周期性扫描本网段内有没有主机在访问多播数据包。

# 4.6 IP数据包的结构

注意，ARP数据包不是这个格式。
首部：第一部分是固定长度，20字节，是所有IP数据包必须具有的。后一部分是可选字段，长度可变。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200103224342694.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
每一行32bit相当于1个字节，一共5行，共20字节。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200103224429788.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(1)版本：用来表示TCP/IP是哪个版本，ipv4还是ipv6.
(2)区分服务：确定更高的传输优先级。
(3)总长度：确定数据部分长度。一共是16位，最多有2^16-1=65535字节。

> 注意，网络层，数据包最大65535字节；而数据链路层数据最大是1500字节，是不一样的。所以说，一旦超过数据链路层的最大要求时(网络层数据部分超过1480字节)，数据包会分片。最大传输单元MTU。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200103224445401.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

> 数据包分片：把数据分割，分别添加IP地址，通过网络发给目标MAC地址。目标在通过网络层拼接。传送过程中可能会丢包，或者后发的先到(泪滴攻击就是利用目标机发送破坏的IP包(重叠的包货过大的包负荷)可以通过TCP/IP协议来瘫痪各种不同的操作系统)。所以需要编号。

(4)标识：如果出现数据包分片，那么标识用来确定哪些数据包是需要组合的。
(5)标志：确定该数据包是完整的还是分片中的一部分。占3位，只有前两位有用，标志字段最低位是MF(More Fragment)，MF=1表示后面还有分片，MF=0表示最后一个分片。标志字段中间一位是DF(Don’t Fragment)，只有DF=0才允许分片。
(6)片偏移：偏移等于当前字节在数据部分的第几个再除以8.(下图是一个举例)
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010322450658.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(7)生存时间：就是TTL，time to live，每过一个路由器就减1。8位二进制。防止数据包在网络中循环。
(8)协议：用协议号标识数据部分是什么数据。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200103224518593.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

> ICMP协议号：1；
> IGMP协议号：2；
> TCP协议号：6；
> UDP协议号：17；域名解析
> IPv6协议号：41；
> OSPF协议号：89；

(9)首部检验和：16位，只检验数据报的首部，不检验数据部分。这里不是采用CRC检验码而是采用简单的计算方法。每经过一个路由器就会检验一次。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200103224539933.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(10)源地址和目的地址都是IP地址，32位，只符合IPv4。IPv6是128位。
(11)可变部分：一般没用。

# 4.7 IP协议

(1)网络畅通的条件
沿途路由器必须知道下一跳给谁，数据包有去有回。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200103224613301.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 4.7.1 静态路由

需要管理员告诉路由器所有没有直连的网络下一跳给谁。
适合于小规模网络，不能自动调整路由。

## 4.7.2 动态路由

(1)RIP协议
周期性广播(30s)路由表，选择路径的依据是最少的跳数，最大跳数是15跳，所以一般不适合大网络。
(2)OSPF协议
根据带宽选择路径。

# 4.8 子网掩码

能够帮助路由器判断对应主机是否在同一个网段中。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105161511780.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

# 4.9 ABCDE类网络地址

网络地址(网络号)唯一指定了每个网络。同一网络中的每台计算机都共享相同的网络地址，并用它作为自己IP地址的一部分。ABC对应的子网掩码分别是255.0.0.0和255.255.0.0和255.255.255.0
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105161549762.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
特殊的几个地址

> 127.0.0.1 本地换回地址
> 169.254.0.0
> 10.0.0.0，172.16.0.0–172.31.0.0，192.168.0.0–192.168.255.0 保留的私网地址

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105161615892.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

# 4.10 子网划分

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105161720106.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105161740472.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
注意，全为1是广播，所以63，127，191，254不选
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105161804726.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

**参考文献**
https://www.bilibili.com/video/av9876107?p=7

# 5 传输层

第五章 传输层
->传输层协议UDP和TCP
->网络安全
->TCP可靠传输的实现
->TCP的流量控制
->TCP的拥塞控制
->TCP的运输连接管理

# 5.1 OSI和DoD模型

下图必须背下来。尤其是传输层和网络层的协议。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182238490.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
传输层最大数据包是65535字节，而网络层数据最大只有1480字节。所以需要分段，但是只要分段，就有可能丢包，因为网络层不负责可靠传输。所以要求服务器和客户端保持会话，直到数据传输完成。

->TCP(Transmission Control Protocol)传输控制协议
应用场景：需要将要传输的文件分段传输时；就需要TCP协议来建立会话实现可靠传输；同时也有流量控制功能。(例如QQ传文件)
查看会话 netstat -n
查看建立会话的进程 netstat -nb

->UDP(User Data Protocol)用户数据报协议
应用场景：一个数据包就能完成数据通信；不需要建立会话和流量控制；多播/广播；是一种不可靠传输。(例如QQ聊天，屏幕广播)

# 5.2 传输层协议和应用层协议的关系

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010418225712.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(1)TCP和UDP协议和不同的端口即可对应一个应用层的协议。注意，53大部分是与UDP相连。
(2)熟知数值一般为0-1023，登记端口号数值1024-49151，客户端口号数值为49152-65535.
(3)常用的应用层协议使用的端口(号)：
http = TCP + 80
Https = TCP + 443
RDP = TCP + 3389
ftp = TCP + 21
共享文件夹 = TCP + 445
SMTP = TCP + 25
POP3 = TCP + 110
telnet = TCP + 23
SQL = TCP + 1433
DNS = UDP + 53
(注意与4.6 的协议号的区别)

# 5.3 服务和应用层协议的关系

防火墙是基于网卡的，只打开必要的端口，不必要的端口不允许接收数据，不影响服务的运行和监听。
服务使用TCP或UDP的端口侦听客户端请求；
客户端使用IP地址定位服务器，使用目标端口，定位服务；
可以在服务器网卡上设置只开放必要的端口，实现服务器网络安全。

## 5.3.1 如何在Windows上安装服务

DNS服务
Web服务
SMTP
POP3

## 5.3.2 如何查看服务侦听的端口

netstat -a
netstat -an 以数字的形式查看端口
netstat -n 查看建立的会话
netstat -nb 查看建立会话的进程
telnet 192.168.80.100 3389 测试到远程计算机某个端口是否打开
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182334264.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 5.3.3 如何更改服务使用默认端口

可以迷惑病毒，使系统更加安全。

## 5.3.4 如何设置Windows网络安全

设置本地连接 TCP/IP筛选

# 5.4 传输层功能和端口范围

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182348169.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 5.4.1 传输层协议和网络层协议的主要区别

网络层实现如何把数据包从这个地址(服务器)发送到另一个地址(服务器)。
传输层实现如何让这个应用程序找到对应计算机的应用程序(相对应的应用程序实现逻辑通信)。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182407430.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 5.4.2 传输层的主要功能

(1)传输层为应用进程之间提供了端到端的逻辑通信(但网络层是为主机之间提供逻辑通信)。
(2)传输层还要对收到的报文进行差错检验。
(3)传输层提供面向连接(TCP)和无连接(UDP)的服务。

## 5.4.3 传输层的端口

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182425652.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(1)TCP的端口
端口用一个16位端口号进行标志。
端口号只具有本地意义，即端口号只是为了标志本计算机应用层的各进程。在Internet中不同计算机的相同端口号是没有联系的(最好不要有冲突)。

# 5.5 UDP协议

(1)UDP是无连接的，即发送数据之前不需要建立连接。
(2)UDP使用尽最大努力交付，即不保证可靠交付，同时也不使用拥塞控制。
(3)UDP是面向报文的，适合多媒体通信的要求。
(4)UDP支持一对一，一对多，多对一，多对多交互通信。
(5)UDP首部开销小，只有8个字节。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182437891.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 5.5.1 UDP的首部格式

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182453304.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
首部中的长度指的是UDP用户数据报的长度(首部+数据)。
伪首部用于检验和，我的理解是伪首部是IP数据包首部的后部分。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182503206.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

# 5.6 TCP协议

(1)TCP是面向连接的传输层协议。(三次握手)
(2)每一条TCP连接智能有两个端点(endpoint)，每一条TCP连接只能时点对点的(一对一)。
(3)TCP提供可靠交付的服务。(确保不丢包)
(4)TCP提供全双工通信。(因为需要接收端的反馈，例如如果接收端处理不过来，可让发送端慢一点，流量控制)
(5)面向字节流。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182520945.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
如果要传输一个比较大的数据，首先一次只会传输一小块，这个数据块的大小是没有规律的。加上数据包数据帧的头，发送给接收端，接收端去掉首部，再次拼接。

## 5.6.1 TCP的连接

(1)TCP把连接作为最基本的抽象。
(2)每一条TCP连接有两个端点。
(3)TCP连接的端点不是主机，不是主机的IP地址，不是应用程序，也不是传输层协议端口，TCP连接的端点叫 套接字(socket).
->套接字socket = (IP地址:端口号)
->每一条TCP连接唯一地被通信两端的两个套接字所确定，即：
->TCP连接 ::= {socket1, socket2} = {(IP1:port1), (IP2:port2)}
(4)端口号拼接到IP地址即构成了套接字。

# 5.7 TCP如何实现可靠传输

(1)可靠传输的工作原理——停止等待协议。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182536235.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
->在发送完一个分组后，必须暂时保留已发送的分组的副本。
->分组和确认分组都必须进行编号。
->超时计时器的重传时间应当比数据在分组传输的平均往返时间更长一些。
(2)确认丢失和确认迟到
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182551725.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(3)可靠通信的实现
->使用上述的确认和重传机制，微秒就可以在不可靠的传输网络上实现可靠的通信。
->这种可靠传输的协议常称为自动重传请求ARQ(Automatic Repeat reQuest)。
->ARQ表明重传的请求是自动进行的。接收方不需要请求发送方重传某个出错的分组。
->缺点，信道利用率低。
![在这里插入图片描述](https://img-blog.csdnimg.cn/202001041825590.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
->信道利用率U
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182617681.png)
(4)流水线传输(发送方)
发送方可连续发送多个分组，不必每发完一个分组就停顿下来等待对方的确认。由于信道上一直有数据不间断的传送，这种传输方式可获得很高的信道利用率。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182630295.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(5)连续ARQ协议
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182635697.png)
如果1确认收到了，则滑动窗口。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182647647.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
如果12收到了，3没有收到，则滑动窗口会会回溯到3位置，重新发送。
(6)累计确认(接收方)
接收方一般采用累计确认的方式。
优点：容易实现，信道利用率高。
缺点：不能向发送方反映出接收方已经正确收到的所有分组的信息。

# 5.8 TCP报文段的首部格式

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182702877.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(1)源端口：2个字节16位。
(2)目的端口：2个字节16位。
(3)序号：当前数据的第一个字节在整个文件中的序号。
(4)确认号ack：接收端发送，提示发送端下一次该发的数据在整个文件中的序号。接收端收到后，会把这个序号之前的数据从缓存中删掉。
(5)数据偏移：当前TCP报文段第多少个字节后是TCP的数据部分了。数据偏移最多表示1111，即15，他最多可以表示15乘以4，即60个字节的偏移量，所以选项+填充最多只能是40个字节。
(6)保留：6位，无作用。
(7)URG：urgent，意思是优先级高，发送端优先发送，而不是在缓存中排队。
(8)ACK：acknowledge，1意味着确认建立了会话。
(9)PSH：1意味着接收端优先读取，而不是在缓存中排队。
(10)RST：reset，1意味着TCP会话出现严重错误，必须释放和重新连接。
(11)SYN：同步。1意味着要发起会话。
(12)FIN：finish，1意味着释放连接。
(13)窗口：接收端先发，发送端根据接收端的窗口尺寸确定发送端窗口尺寸。
(14)检验和：
(15)紧急指针：只有URG为1才有用。

## 5.8.1 抓包分析P64

(1)
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010418271350.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
第一步，ARP，建立可靠传输
第二步，UDP(DNS同时占用UDP和TCP的53端口)，域名解析
第三步，TCP，识别网关MAC地址

(2)cmd打开控制台如下，当前是建立了2个会话。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182730288.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(3)浅蓝：请求的数据包；深蓝：得到的结果；
192是我方地址；8是服务器地址；
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182741822.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

(4)两个SYN是双方确认建立了会话，MSS意思是最大数据包1460字节，web端(219.148.36.48)最多能缓存win=64240字节，我端(192.168.80.63)最多能缓存win=65535字节,如果某一方发了另一方win字节个数据对方都没有确认，那么就暂停。标记为TCP这三行(12,13,14)，不光是建立对话，还协商了一些参数。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182755319.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(5)第15行，开始正式通信，HTTP。GET的意思是我要访问这个网站了。白框内写着各个层的数据首部的结构。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182804430.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
目标端口Src Port是80，源端口Dst Port是1057，序号Sep是1，确认号Ack是1，数据部分长度是1-203字节。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182816908.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(6)219->192是发送网页信息，192->219是确认反馈。注意，16第一次发送数据和19反馈接收是没有数据len=0。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182826925.png)
从建立会话，到传输数据到确认反馈的一个过程如下，15-19。
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010418283931.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

# 5.9 TCP如何实现可靠传输P67

## 5.9.1 以字节为单位的滑动窗口技术

A的发送窗口是由B的接受窗口长度决定的。
在没有收到B确认收到之前，A不能删掉滑动窗口内的内容。
A可以持续给B发送，直到A的滑动窗口内数据都发了。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182910778.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
B收到后给A发确认收到的反馈ACK，序号是下一个应该发送的字节的序号，A收到后，就可以滑动窗口到对应的位置。例如B反馈ACK是7，那么A的滑窗可以移动到7位置，1-6删除。21-26可以发送。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182934629.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
B收到1-6之后，也开始滑窗，B的应用程序可以读取1-6的数据。B的滑窗继续接收。
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010418294182.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
以上是正常状态下的情况。如果出现丢失情况，例如7-9丢失，此时B反馈的ACK=7.因为10-12收到了，因此B发送SACK(选择性确认)，A只发送7-9.
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104182958855.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 5.9.2 超时重传时间的确定

TCP美发送一个报文段，就对这个报文段设置一次计时器。只要计时器设置的重传时间到了，但是还没有收到数据，那么就重传这一报文段。
RTTs(new) = (1 - alpha) x (RTTs(old)) + alpha x (new RTT样本)
超时重传时间应略大于上面得出的加权平均往返时间RTTs。alpha推荐值是0.125.
这个公式的目的是根据网速和带宽的实时情况调整往返时间。

# 5.10 TCP如何实现流量控制P68

解决通信两端处理时间不一样的问题。通过实时调整滑窗尺寸的大小(尺寸甚至可以是0)来实现流量控制。接收端主动调整滑窗大小，发送端根据接收端发送的报文调整相应的滑窗。发送端也会定时发送报文向接收端确认滑窗信息，避免接收端发送的相关调整滑窗大小的报文丢失带来的影响。

# 5.11 TCP如何避免网络拥塞

(1)出现资源拥塞的条件：对资源需求的总和>可用资源。
(2)拥塞控制是一个全局性的过程，涉及到所有的主机，所有的路由区，以及与降低网络传输性能有关的所有因素。
(3)流量控制往往指在给定的发送端和接收端之间的点对点通信量的控制，它所要做的就是抑制发送端发送数据的速率，以便使接收端来得及接收。

## 5.11.1 拥塞控制起到的作用

红线和绿线之间是数据丢失内容。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104183007298.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
5.11.2 慢开始和拥塞避免
(1)发送方维持 拥塞窗口cwnd(congestion window)
(2)发送方控制拥塞窗口的原则是：
只要网络没有出现拥塞，拥塞窗口就再增大一些，以便把更多的分组发送出去；
只要网络出现拥塞，拥塞窗口就减少一些，以减少注入到网络中的分组数。
(3)慢开始算法的原理
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104183026234.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(4)设置慢开始门限状态变量ssthresh
慢开始门限状态变量ssthresh的用法如下：
当cwnd<ssthresh时，使用慢开始算法；
当cwnd>ssthresh时，停止使用慢开始算法，改用拥塞避免算法；
当cwnd=ssthresh时，使用慢开始算法或拥塞避免算法均可；
(5)拥塞避免算法的思路
让拥塞窗口cwnd缓慢地增大，即每经过一个往返时间RTT就把发送方的拥塞窗口cwnd加1，而不是加倍，使拥塞窗口cwnd按线性规律缓慢增长。
(6)当网络出现拥塞时对策
无论是在慢开始阶段还是在拥塞避免阶段，只要发送方判断网络出现拥塞(其根据就是没有按时收到确认)，就要把慢开始门限ssthresh设置为出现拥塞时的发送方窗口值的一半(但是不能小于2)。
然后把拥塞窗口cwnd重新设置为1，执行慢开始算法。
这样做的目的就是要迅速减少主机发送到网络中的分组数，使得发生拥塞的路由器有足够的时间吧队列中积压的分组处理完毕。
(7)慢开始和拥塞避免算法的实现举例
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104183041722.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
->拥塞避免并非指完全能够避免拥塞。利用以上的措施要完全避免网络拥塞还是不可能的。
->拥塞避免是说在拥塞避免阶段吧拥塞避免窗口控制为按线性规律增长，使网络比较不容易出现拥塞。

## 5.11.3 快重传和快恢复

快重传算法首先要求接收方每收到一个失序的报文段后就立即发出重复确认，这样做可以让发送方及早知道有报文段没有到达接收方。
当发送端收到连续三个重复的确认时，就执行“乘法减少”算法，即把慢开始门限ssthresh减半，但拥塞窗口cwnd现在不设置为1，而是设置为慢开始门限ssthresh减半后的数值，然后开始执行拥塞避免算法(“加法增大”)，使拥塞窗口缓慢地线性增大。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104183058971.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 5.11.4 发送窗口的实际上限制

取接收方窗口和 拥塞窗口 这两个变量中的较小值。
发送窗口的上限制 = min {rwnd, cwnd}.

# 5.12 TCP传输连接管理

传输连接有三个阶段，即：连接建立，数据传送，连接释放。
TCP连接的建立都是采用客户服务器方式。
主动发起连接建立的应用进程叫做客户(client)。
被动等待连接建立的应用进程叫做服务器(server)。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200104183113214.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
头两次握手除了确定双方都能联通外，还通知了双方的一些端口信息。
第三次握手原因：假如把三次握手改成仅需要两次握手，死锁是可能发生的。作为例子，考虑计算机A和B之间的通信，假定A给B发送一个连接请求分组，B收到了这个分组，并发送了确认应答分组。按照两次握手的协定，B认为连接已经成功地建立了，可以开始发送数据分组。可是，B的应答分组在传输中被丢失的情况下，A将不知道B是否已准备好，A认为连接还未建立成功，将忽略B发来的任何数据分组，这样就形成了死锁。
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010418312417.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

参考文献
https://www.bilibili.com/video/av9876107?p=7



- 建立连接为什么要三次握手，首先应该明白前两次握手是必须保证成功的，因为他们会发送各自的同步信息如接收窗口大小、最大数据包（MSS）等进行同步。如果没有这两次握手，连接就不可能成功建立，而第三次握手就是为了保证前两次的成功。现在来考虑几种极端情况。1、三次握手的前提下，如果一次同步a->b失败（可能丢失也可能绕了远路导致超时），a会超时重传；二次同步b->a失败，a依然超时重传；三次握手a->b失败，a由于收不到b发送的数据，还是会超时重传。如果在二三次超时重传次数超过某一限额就会重新执行tcp连接。2、二次握手的前提下，没有了第三次保证前两次成功，如果一次同步a->b失败，超时重传即可；二次同步b->a丢失，b认为连接已经建立成功，发送数据，a由于并未收到二次同步，拒绝接收数据。相当于b在浪费自己的处理资源也在浪费网络资源造成死锁。2月前

  ![点赞](https://blog.csdn.net/static_files/template/new_img/commentUnHeart.png)1

- - ![Isen__](https://profile.csdnimg.cn/3/F/5/3_isen__)

    [Isen__](https://me.csdn.net/Isen__)回复**:**为什么要四次挥手？为什么断开连接的时候不像建立连接一样三次就够了？在第二步b->a要发送两次呢。因为TCP是全双工模式，这就意味着，当主机1发出FIN报文段时，只是表示主机1已经没有数据要发送了，主机1告诉主机2，它的数据已经全部发送完毕了；但是，这个时候主机1还是可以接受来自主机2的数据；当主机2返回ACK报文段时，表示它已经知道主机1没有数据发送了，但是主机2还是可以发送数据到主机1的；当主机2也发送了FIN报文段时，这个时候就表示主机2也没有数据要发送了，就会告诉主机1，我也没有数据要发送了，之后彼此就会愉快的中断这次TCP连接。2月前

# 6 应用层

应用层的协议就是服务。

# 6.1 域名协议DNS(Domain Name System)

## 6.1.1 作用

把域名解析为IP地址。例如打得开QQ(可以直接用IP地址登陆)，打不开网络可能是域名问题。
8.8.8.8 是google的DNS服务器，222.222.222.222是电信的DNS服务器，能够用来帮忙解析域名地址。

## 6.1.2 域名

根 .
顶级域名 com, edu, net,cn,org,gov
二级域名 91xueit, inhe，例如91xueit.com是全球唯一的域名。
三级域名 dba，例如www.dba.91xueit.com
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105224546868.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
Ping或nslookup能得到IP地址。或者直接输入网址。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105224559915.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

# 6.2 动态主机配置系统DHCP(同一个网段)

(1)静态IP地址
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105224616347.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(2)动态IP地址
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105224628673.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

(3)DHCP客户端请求IP地址的过程
我的理解这是一个动态IP地址的请求和分配过程。客户机在网中发广播请求地址，目标IP是4个255，目标MAC地址是全FF。DHCP收到后，会从地址池里选一个给客户机。如果网络中有2个DHCP服务端且都给了反馈，此时计算机还需要返回一个数据通知他选择了谁提供的地址。另一个DHCP客户端发现没要他的，于是收回他提供的。从这个角度看，网络中不能有太多的DHCP服务端。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105224643189.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(4)DHCP服务器的安装
必须是固定的IP地址。释放命令为ipconfig /release
(5)DHCP跨网段配置IP地址
需要DHCP配IP地址的计算机，需要在他所在的网络的路由器的网关上配置IPhelper address，再访问到DHCP。

# 6.3 文件传输协议FTP(File Transfer Protocol)

## 6.3.1 FTP使用的两个TCP连接

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105224653853.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
FTP的连接方式包括控制连接和数据连接。每上传/下载一个文件就会建立一个会话。
控制连接：标准端口为21，用于发送FTP命令信息。
数据连接：标准端口为20，用于上传/下载数据。

## 6.3.2 FTP数据连接(上图的TCP数据连接)

涉及到主动模式和被动模式
(1)主动模式：FTP客户端告诉FTP服务器(的21端口)它在使用什么端口侦听，然后FTP服务器(的20端口)主动地和FTP客户端的这个端口建立连接。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105224711725.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(2)被动模式：FTP服务器端打开在指定范围内的某个新的端口(例如1089端口)并且进行侦听，被动地等待客户端发起连接。
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010522472251.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
综上，在有防火墙的情况下，如果使用被动模式，防火墙不得不开很多端口来监听。因此应该使用主动模式来进行数据连接，并在防火墙开21和20端口。

## 6.3.3 FTP传输模式

文本模式：ASCII模式，以文本序列传输数据。
二进制模式：Binary模式，以二进制序列传输数据。

# 6.4 远程终端协议telnet

默认使用TDP23端口。

# 6.5 远程桌面协议RDP(Remote Desktop Protocol)

# 6.6 超文本传输协议HTTP(Hyper Text Transfer Protocol)

通过这个协议访问网站。

## 6.6.1 万维网www(World Wide Web)

(1)www提供分布式服务
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105224801732.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

(2)统一资源定位系统URL(Uniform Resource Locator)
有点像地址。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105224813275.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
网站的标识有多种方式，不同的端口，不同的IP地址，不同的域名(主机头)来区分。

## 6.6.2 使用web代理服务器访问网站

内网其它主机不能通过路由访问Internet，只能由web代理(在同一个网段里)访问外网，然后内网其它主机访问这个web代理来实现上网功能。如果web代理在外网，反而速度更慢。
(1)节省内网访问Internet的带宽(便于访问内容变化不大的网站)。
(2)绕过防火墙访问外网。例如访问某个禁止的网站A，但是假如通过在与A同一个网络中的web代理，就可以访问该网站。
(3)通过web代理避免被跟踪。

# 6.7 电子邮件(SMTP, POP3, IMAP)

SMTP发, POP3和IMAP是收。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105224823180.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
参考文献
https://www.bilibili.com/video/av9876107?p=7

# 7 网络安全

# 7.1 网络安全介绍

## 7.1.1 一个入侵实例

(1)端口扫描，指定一个公网范围扫描端口的地址，调查哪些主机开了1433端口。
(2)将地址拷贝到某个破解数据库管理员密码的软件。

## 7.1.2 安全包括哪些方面

(1)数据(文件/文件夹)存储安全
(2)应用程序安全
(3)操作系统安全
(4)网络安全
(5)物理安全
(6)用户安全教育

# 7.2 计算机网络上的通信面临的威胁

(1)截获——从网络上窃听他人的通信内容。(被动攻击)(例如cain软件)
(2)中断——有意中断他人在网络上的通信。(主动攻击)
(3)篡改——故意篡改网络上发送的报文。(主动攻击)(例如cain软件)
(4)伪造——伪造信息在网络上传送。(主动攻击)
例如，cain软件能够截获和篡改本网段的的报文。它是在主机通过ARP协议寻找网关地址(想上网)的时候，用ARP欺骗，把本电脑的地址发给那个主机，此时，网段内的所有的计算机的报文都会发给cain，这样主机访问外网的时候，都是通过cain访问的(主机访问cain提供的假域名，cain去访问真的域名，再把信息转给主机，这是一种DNS劫持)，既能篡改DNS解析结果，还能获取密码。同样的道理，局域网管理员可以在网关设置监视端口，获得本网段的所有信息。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106175122956.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 7.2.1 被动攻击和主动攻击

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106175133444.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
中断——拒绝服务式攻击
举例：DoS拒绝服务式攻击，通过在网络上拥挤一些没用的数据包来组断网络。一般会占用下载通道ADSL而不是上传通道UDP，因为下载的带宽要大得多。
DDoS分布式攻击，可以在网络上找很多有漏洞的网站(肉鸡)，给指定的服务器发流量来使网络拥挤吃掉带宽，对于这种方式没有什么好办法。
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010617514251.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
篡改——修改域名解析的结果
类似于钓鱼网站，当用户想出入建设银行的域名，解析错误导致用户访问了错误的网站，当用户输入账号密码的话就会导致信息泄漏。
伪造——伪装成其它主机的IP地址
趁其它主机关机时，把IP地址伪装成该主机的IP地址，从而获取信息。

# 7.3 计算机面临的威胁——恶意程序(rogue program)

(1)计算机病毒——会“传染”其它程序，“传染”是通过修改其它程序来把自身或其变种复制进去完成的。(熊猫烧香)
(2)计算机蠕虫——通过网络的通信功能将自身从一个结点发送到另一个结点并启动运行的程序。(消耗CPU资源)
(3)特洛伊木马——一种程序，它执行的功能超过所声称的功能。(和(1)(2)的区别是会和外界通信)
(4)逻辑炸弹——一种当运行环境满足某种特定条件时执行其它特殊功能的程序。

## 7.3.1 木马程序的识别

查看会话netstat -n看看是否有可疑的会话；
运行msconfig服务，把隐藏微软服务掉，看看剩下的有哪些刻意；
杀毒软件。

# 7.4 加密技术

广泛应用于应用层加密。

## 7.4.1 对称加密

加密密钥和解密密钥是同一个。
缺点：密钥不适合在网上传；密钥是一对一的，如果有很多主机相互通信，有很多密钥需要维护；
优点：效率高。
加密包括加密算法和加密密钥。

## 7.4.2 数据加密标准DES

(1)它属于常规密钥密码体制，是一种分组密码。在加密前，先对整个铭文进行分组，每一个租场为64位，然后对每一个64位二进制数据进行加密处理，产生一组64位密文数据。最后将各组密文串接起来，即得出整个密文。使用的密钥是64位(实际密钥长度位56位，有8位数用来奇偶校验)。
(2)DES的保密性
仅取决于对密钥的保密，而算法本身是公开的。尽管人在破译DES上有很多进展，但是至今没有找到比穷举搜索密钥更有效的方法。
DES是世界上第一个公认的使用密码算法标准，它曾对密码学的发展做出了重大贡献。
目前较为严重的问题是DES的密钥的长度。
现在已经设计出来搜索DES密钥的专用芯片。
DES算法公开，所以破解取决于密钥长度，56位密码破解需要3.5-21min；128位密钥破解需要5.4*10^18年。

## 7.4.2 非对称加密

(1) 加密密钥和解密密钥是不同的，有一对密钥对，公钥和私钥。
要么公钥加密私钥解密；要么私钥加密公钥解密。
(2)优点：给出私钥和公钥其中一个无法算出另一个。
(3)缺点：效率低。
(4)非对称加密实现细节：
设A是非对称加密机制；B为对称加密机制；A1要给A2传一组数据，很大，如果直接用非对称加密花的时间很长；为了加快速度，用对称加密手段B来加密这个数据得到加密后数据B’和密钥B给A1，速度很快；然后A1对密钥B进行非对称加密得到公钥A1’；A1把密钥A1’和数据B’发给A2；A2运用私钥解密A1’获得密钥B，再用密钥B解密这个数据，最终得到想要的结果。
通过这种对数据采用对称加密，对对称加密的密钥进行非对称加密的方式能实现快速加密。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106175216686.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 7.4.3 数字签名

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106175232980.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
防止抵赖，能够检查签名后的内容有没有被更改过。

## 7.4.4 证书颁发机构CA

来验证公钥是否是证书颁发机构认证过。
为企业和用户办法数字证书，确认这些企业和个人的身份；
如果证书丢失，它要发布证书吊销列表；
企业和个人是信任证书颁发机构的。

# 7.5 Internet上使用的安全协议

## 7.5.1 安全套接字SSL(Secure Sockets Layer)

(1)SSL的位置
是在应用层和传输层之间进行加密。好处是应用层和传输层都不需要来加密。不需要应用程序(应用层)来支持，但是需要在服务器配置证书。
例如，不使用SSL加密使用的是http://，使用SSL加密是https://。
注意，http://使用的是TCP的80端口，而https://使用的是TCP的443端口。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106175250764.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(2)SSL的配置(加密的实现)(https://)
客户端有一个浏览器IE，想要访问服务器端的网站web；
浏览器IE要访问网站web，此时网站web会把他的公钥给浏览器IE；
浏览器IE通过校验CA证书确保网站web的公钥是可靠的；
浏览器IE会产生一个对称密钥；
浏览器IE拿着网站web的公钥对它的对称密钥进行加密，发给网站web；
网站web用它的私钥进行解密，就得到了浏览器IE的对称密钥；
所以说，本质上是用对称密钥对数据进行加密的，公钥和私钥是用来对这个对称密钥进行加密的。这也是为什么https://刚开始打开的时候会有一些慢。
(3)另外一些协议使用的安全套接字SSL时对应的TCP端口
imaps tcp-993
pop3s tcp-995
smtps tcp-465
https tcp-443
(4)SSL提供的三个功能
->SSL服务器鉴别：允许用户证实服务器的身份；具有SSL功能的浏览器维持一个表，上面有一些可信赖的认证中心CA(Certificate Authority)和它们的公钥。
->加密的SSL会话：客户和服务器交互的所有数据都在发送方加密，在接收方解密。
->SSL客户鉴别：允许服务器证实客户的身份。

## 7.5.2 网络层安全IPSec

网络层安全是底层安全，不需要应用程序支持，也不需要配置证书，对用户是透明的(感觉不到)。
(1)安全关联SA(Security Association)
在使用AH或ESP之前，先要从源主机到目的主机建立一条网络层的逻辑连接。此逻辑连接叫做安全关联SA。
IPsec就把传统的Internet无连接的网络层转换为具有逻辑连接的层。
SA是构成IPSec的基础，是两个通信实体经过协商(利用IKE协议)建立起来的一种协定，它决定了用来保护数据分组安全的安全协议(AH协议(只签名：只关心发送方的身份而不关心数据是否被窃取)或ESP协议(既签名又对数据加密))，转码方式，密钥及密钥的生存周期等。
(2)IPsec中最主要的2个协议
->鉴别首部AH(Authentication Header):AH鉴别源点和检查数据完整性，但不能保密。
在使用AH时，把AH首部插在原数据报数据部分的签名，同时把IP首部中的协议字段设置为51.
在传输过程中，中间的路由器都不查看AH首部。当数据报到达终点时，目的主机才会处理AH字段，以鉴别源点和检查数据报的完整性。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106175317765.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
->封装安全有效载荷ESP(Encapsulation Security Payload):ESP比AH复杂的多，它鉴别源点，检查数据完整性和提供保密。
使用ESP时，IP数据报首部的协议字段设置为50.当IP首部检查到协议字段是50时，就知道在IP首部后面紧跟着ESP首部，同时在原IP数据报后面增加了2个字段，即ESP尾部和ESP数据。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106175332616.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

# 7.6 数据链路层安全(链路加密与端到端加密)

PPP 身份验证
ADSL

# 7.7 防火墙(firewall)

防火墙用来解决内联网和外联网的安全问题。
防火墙是由软件，硬件构成的系统，是一种特殊编程的路由器，用来在两个网络之间实施接入控制策略。接入控制策略是由防火墙的单位自行制定的，为的是可以最适合本单位的需要。
防火墙内的网络称为“可信赖的网络”(trusted network)，而将外部的Internet称为“不可信赖的网络”(untrusted network)。

## 7.7.2 防火墙在互联网中的位置

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106175739708.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 7.7.3 防火墙的功能

(1)阻止：阻止某种类型的通信量通过防火墙(从外部网络到内部网络，或反过来)。
(2)允许：允许某种类型的通信量通过防火墙(从外部网络到内部网络，或反过来)。
防火墙必须能够识别通信量的各种类型。一般是阻止功能。

## 7.7.4 防火墙技术的分类

(1)网络层防火墙：用来防止整个网络出现外来非法的入侵。属于这类的有分组过滤和授权服务器。前者检查所有流入本网络的信息，然后拒绝不符合事先制订好的一套准则的数据，而后者则是检查用户的登录是否合法。
可以基于数据包，源地址，目标地址，协议和端口来控制流量。
(2)应用层防火墙：从应用程序来进行接入控制，通常使用应用网关或代理服务器来区分各种应用。例如，可以只允许用过访问www的应用，而阻止FTP应用的通过。
应用级防火墙可以检查数据报的内容。
可以基于数据包，源地址，目标地址，协议和端口，用户名，时间段来控制内容，可以放病毒，可见功能更强大。

## 7.7.5 防火墙的结构

(1)边缘防火墙
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106175901517.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(2)三向外围网
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106175907267.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
DMZ是公司内部的服务器。内网可以访问外网，外网不能访问内网，只能访问服务器DMZ。
(3)背靠背防火墙
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106175931459.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(4)单一网卡防火墙
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106175947262.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

参考文献
https://www.bilibili.com/video/av9876107?p=7

# 8 Internet上的音频视

# 8.1 Internet上传输音频视频面临的问题

占用带宽高，要求网速恒定延迟低。而数据信息，对带宽要求低，网速不稳定，延迟高也没事。
(1)延迟：发送时延，传播时延，排队时延，处理时延(路由的路径选择)，不过对于非交互式的音频视频的影响会小一些。
(2)带宽不稳定。需要在接收端设置缓存(看电影时可以弥补数据包没按顺序接收到的问题)。

# 8.2 Internet上提供的音频/视频服务的类型

(1)流式存储音频/视频——边下载边播放。
(节省客户端硬盘空间，不用下载；保护视频版权)
(2)流式实况音频/视频——边录制边发送。
(通过网络，现场直播)
(3)交互式音频/视频——实时交互式通信。
(流式：streaming)

# 8.3 流式实况音频/视频

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106123534114.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

# 8.4 IP电话

狭义的IP电话：IP网络上打点电话。“IP网络”指“使用IP协议的分组交换网”的简称。
广义的IP电话：不仅仅是电话通信，而且还可以是在IP网络上进行交互式多媒体实时通信(包括话音/视像等)，甚至还包括即时传信IM(Instant Messaging)(QQ聊天/视频)。

## 8.4.1 IP电话网关的机中连接方法

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106123538502.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

## 8.4.2 IP电话的通话质量

由2个因素决定。
(1)通话双方端到端的时延和时延抖动。
(2)话音分组的丢失率。
但是这两个因素是不确定的，是取决于当时网络上的通信量。
经验证明，在电话交谈中，端到端的时延不应超过250ms，否则交谈者就能感受到不自然。

## 8.4.3 改进网络层“尽最大努力交付”的服务

注意，网络层的目的就是“尽最大努力交付”，他不关心数据包是什么，谁着急。但是音频/视频就应该优先级更高，所以需要改进网络层“尽最大努力交付”的服务(QoS)。
服务质量QoS是服务性能的总效果，此效果决定了一个用户对服务的满意程度。因此在最简单的意义上，有服务质量的服务就是能够满足用户的应用需求的服务。
服务质量可用若干基本的性能指标来描述，包括可用性，差错率，响应时间，吞吐量，分组丢失率，连接建立时间，故障检测和改正时间等。服务提供者可向其用户保证某一种等级的服务质量。

## 8.4.4 服务器如何实现优先传输音频/视频数据包

QoS的一些手段：
(1)基于标记的优先级确认
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106123553294.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
(H1->H3是实时音频通信，H2->H4是文件传输)
需要给不同性质的分组打上不同的”标记”。当H1和H2的分组进入R1时，R1应能识别实时数据分组，并使这些分组以高优先级进入输出队列，而仅在队列有多余空间时才准许低优先级的FTP数据分组进入。

(2)基于分类的优先级确认
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106123615185.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
应当使路由器增加分类(Classification)机制，即路由器根据某些准则(例如根据发送数据的地址)对输入分组进行分类，然后对不同类别的通信量给予不同的优先级。

(3)流量管制机制![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106123628613.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
路由器应能对数据流进行通信量的管制(policing)，使该数据流不影响其它正常数据流在网络中通过。例如可将H1的数据率限定为1Mb/s。R1不停地监视H1的数据率。只要其数据率超过规定的1Mb/s，R1就将其中的某些分组丢弃。

(4)调度机制
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106123636302.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
应在路由器中再增加调度(scheduling)机制。利用调度功能给实时音频分配1.0Mb/s的带宽,给文教传送分配0.5Mb/s的带宽(相当于在带宽为1.5Mb/s的链路中划分出两个逻辑链路)，因而对这两种应用都有相应的服务质量保证。

(5)呼叫接纳
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200106123656660.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
总数据率已经超过1.5Mb/s链路的带宽。比较合理的做法是让一个数据流通过1.5Mb/s的链路，而组织另一个数据流的通过。这就需要呼叫接纳(call admission)机制。数据流要预先声明所需的服务质量，然后要么被准许进入网络，要么被拒绝进入。

参考文献
https://www.bilibili.com/video/av9876107?p=7

# 9 无线网络

# 9.1 几种无线网络的对比

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105202232339.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
PAN：个人局域网
LAN：无线局域网
MAN：无线城域网
WAN：无线广域网

# 9.2 无线局域网的组成

重点讨论LAN。思路是设备的无线网卡和无线路由的AP连接，组成无线局域网，无线AP给无线设备分配IP。
基本服务集内的基站叫做接入点(Access Point)。
当网络管理员安装AP时，必须为该AP分配一个不超过32字节的 服务集标识符SSID 和 一个信道。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105202246698.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
两个无线IP通过网线连接，这样两个无线局域网可以看成一个整体的网络，两个AP类似于集线器。

# 9.3 无线路由

(1)传统的ADSL拨号上网
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105202251410.png)
电话线接入分离器，与猫(调制解调器)的ADSL连接(分离器出来的另一条线连接电话)，LAN是接网线的口，与电脑的网卡连接，然后在电脑上创建ADSL拨号连接，输入账号密码，获得一个公网连接的IP地址，从而连入网络。这种方式只能连接一个电脑。

(2)无线路由
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105202304851.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
为了实现给家庭内多个设备接入网络，需要一个无线路由((1)中相同原理)，与猫连接(下图白色标记方框)，此时无线路由扮演一个路由的作用；蓝色方框(相当于交换机)是给家庭内需要有线上网的设备连接；无线路由的天线(相当于AP)是给室内手机和笔记本进行无线通信。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105202313608.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)
实际上无线路由相当于集合了路由，AP和交换机三个设备的功能。室内的无线和有线设备都在一个网络里，使用的是无线路由的路由部分的网关。

# 9.4 移动自组网络

自组网络是没有固定基础设施的(即没有AP)的无线局域网。这种网络由一些处于平等状态的移动站之间相互通信组成的临时网络。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200105202334463.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l3YW5kZXJ1,size_16,color_FFFFFF,t_70)

# 9.5 3G/4G

移动运营商在全国有很多基站，不同的手机会自动向最近的基站进行注册，手机通话时，连接顺序是手机A-基站A-基站B-手机B，如果手机移动位置的时候，会更改注册的基站，并更改数据库。

